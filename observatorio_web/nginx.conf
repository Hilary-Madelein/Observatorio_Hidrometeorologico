server {
    listen 80;
    server_name computacion.unl.edu.ec;

    # 1) ROOT GENERAL PUNTO A /var/www
    #    De ese modo, cuando pida /hid/algo, Nginx buscará en /var/www/hid/algo.
    root /var/www;

    # 2) REDIRIGIR “/” --> “/hid/”
    #    Si entran a http://computacion.unl.edu.ec sin nada más, los mandamos a /hid/.
    location = / {
        return 302 /hid/;
    }

    # 3) SERVIR LA SPA REACT BAJO /hid/
    location /hid/ {
        # try_files intentará primero usar el archivo tal cual:
        #   /hid/algo/archivo.js  -> /var/www/hid/algo/archivo.js
        # Si no existe, pasará a /hid/index.html para que React Router maneje rutas internas.
        try_files $uri $uri/ /hid/index.html;
    }

    # 4) PROXY PARA /api/
    location /api/ {
        # Suponiendo que tu backend corre (dentro de Docker) en el mismo contenedor 
        # o en la misma red, pero expuesto en http://localhost:3006. 
        # Si estás usando docker-compose y tu servicio de backend se llama “observatorio_api”,
        # en lugar de “localhost” deberías poner “http://observatorio_api:3006/”.
        proxy_pass http://localhost:3006/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 5) LOGS (opcional)
    error_log  /var/log/nginx/error.log warn;
    access_log /var/log/nginx/access.log combined;
}
